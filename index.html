<!DOCTYPE html>
<html>
  <head>
    <title>Phantom Signer (RugCheck)</title>
    <script src="https://unpkg.com/bs58@5.0.0/dist/bs58.min.js"></script>
  </head>
  <body>
    <h2>Sign "Sign-in to Rugcheck.xyz"</h2>
    <button onclick="signMessage()">Sign with Phantom</button>
    <pre id="output"></pre>

    <script>
      async function signMessage() {
        const provider = window.solana;
        if (!provider?.isPhantom) {
          alert("Phantom wallet not found.");
          return;
        }

        await provider.connect();

        const messageStr = "Sign-in to Rugcheck.xyz";
        const timestamp = Math.floor(Date.now() / 1000);
        const fullMessage = JSON.stringify({
          message: messageStr,
          publicKey: provider.publicKey.toString(),
          timestamp
        });

        const encoded = new TextEncoder().encode(fullMessage);
        const signed = await provider.signMessage(encoded, "utf8");

        const output = {
          publicKey: provider.publicKey.toString(),
          message: messageStr,
          timestamp: timestamp,
          signature_base58: bs58.encode(signed.signature),
          signature_bytes: Array.from(signed.signature)
        };

        document.getElementById("output").textContent = JSON.stringify(output, null, 2);
      }
    </script>
  </body>
</html>
